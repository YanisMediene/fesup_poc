<div class="sessions-container">
  <div class="header">
    <button class="btn-back" routerLink="/admin/dashboard">
      â† Retour au tableau de bord
    </button>
    <h1>ğŸ—“ï¸ Gestion des Sessions</h1>
    <button class="btn-delete-all" (click)="deleteAllSessions()" [disabled]="sessions.length === 0" title="Supprimer toutes les sessions">
      ğŸ—‘ï¸ Supprimer Tout
    </button>
    <p class="subtitle">DÃ©finir les activitÃ©s disponibles par salle et crÃ©neau</p>
  </div>

  <!-- GÃ©nÃ©ration automatique -->
  <div class="auto-gen-card">
    <div class="auto-gen-content">
      <div class="auto-gen-info">
        <h3>ğŸ¤– GÃ©nÃ©ration Automatique Intelligente</h3>
        <p>Analysez les vÅ“ux des Ã©lÃ¨ves et crÃ©ez automatiquement les sessions nÃ©cessaires.</p>
        <ul>
          <li>âœ… Les activitÃ©s les plus demandÃ©es auront plus de sessions</li>
          <li>âœ… Optimisation pour satisfaire un maximum de vÅ“ux prioritaires (1 et 2)</li>
          <li>âœ… RÃ©partition automatique sur les crÃ©neaux et salles disponibles</li>
        </ul>
      </div>
      <button class="btn-auto-gen" (click)="genererSessionsAuto()" [disabled]="isGenerating">
        <span *ngIf="!isGenerating">ğŸš€ GÃ©nÃ©rer les sessions automatiquement</span>
        <span *ngIf="isGenerating">â³ GÃ©nÃ©ration en cours...</span>
      </button>
    </div>
    <div class="auto-gen-result" *ngIf="generationResult">
      <div class="result-success">
        âœ… <strong>{{ generationResult.totalSessionsCreees }}</strong> sessions crÃ©Ã©es !
        <span class="result-detail">({{ generationResult.anciennesSessions }} anciennes sessions supprimÃ©es)</span>
      </div>
    </div>
  </div>

  <!-- Formulaire manuel -->
  <div class="form-card">
    <h2>{{ editMode ? 'âœï¸ Modifier' : 'â• CrÃ©er Manuellement' }} une Session</h2>
    <form [formGroup]="sessionForm" (ngSubmit)="onSubmit()">
      <div class="form-row">
        <div class="form-group">
          <label>ActivitÃ©</label>
          <select formControlName="activiteId" class="form-control">
            <option value="">SÃ©lectionner une activitÃ©</option>
            <option *ngFor="let activite of activites" [value]="activite.id">
              {{ activite.titre }} ({{ activite.type }})
            </option>
          </select>
        </div>

        <div class="form-group">
          <label>Salle</label>
          <select formControlName="salleId" class="form-control">
            <option value="">SÃ©lectionner une salle</option>
            <option *ngFor="let salle of salles" [value]="salle.id">
              {{ salle.nom }} ({{ salle.capacite }} places)
            </option>
          </select>
        </div>

        <div class="form-group">
          <label>CrÃ©neau</label>
          <select formControlName="creneauId" class="form-control">
            <option value="">SÃ©lectionner un crÃ©neau</option>
            <option *ngFor="let creneau of creneaux" [value]="creneau.id">
              {{ creneau.libelle }} ({{ creneau.demiJournee | demiJourneeLabel }})
            </option>
          </select>
        </div>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn-primary" [disabled]="sessionForm.invalid">
          {{ editMode ? 'Mettre Ã  jour' : 'CrÃ©er' }}
        </button>
        <button type="button" class="btn-secondary" (click)="resetForm()" *ngIf="editMode">
          Annuler
        </button>
      </div>
    </form>
  </div>

  <!-- Tableau des sessions -->
  <div class="table-card">
    <h2>ğŸ“‹ Sessions configurÃ©es ({{ sessions.length }})</h2>
    <div class="table-responsive">
      <table>
        <thead>
          <tr>
            <th>ActivitÃ©</th>
            <th>Type</th>
            <th>Salle</th>
            <th>CrÃ©neau</th>
            <th>Demi-journÃ©e</th>
            <th>CapacitÃ©</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let session of sessions">
            <td><strong>{{ session.activiteTitre }}</strong></td>
            <td><span class="badge type-{{ session.activiteType }}">{{ session.activiteType }}</span></td>
            <td>{{ session.salleNom }}</td>
            <td>{{ session.creneauLibelle }}</td>
            <td><span class="badge dj-{{ session.creneauDemiJournee }}">{{ (session.creneauDemiJournee || '') | demiJourneeLabel }}</span></td>
            <td class="capacity">{{ session.capaciteDisponible }}</td>
            <td class="actions">
              <button class="btn-edit" (click)="editSession(session)" title="Modifier">âœï¸</button>
              <button class="btn-delete" (click)="deleteSession(session.id!)" title="Supprimer">ğŸ—‘ï¸</button>
            </td>
          </tr>
          <tr *ngIf="sessions.length === 0">
            <td colspan="7" class="empty">Aucune session configurÃ©e</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
