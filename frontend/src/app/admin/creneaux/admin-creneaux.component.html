<div class="creneaux-container">
  <div class="header">
    <button class="btn-back" routerLink="/admin/dashboard">
      <span class="icon">â†</span> Retour
    </button>
    <h1>â° Gestion des CrÃ©neaux</h1>
    <div class="spacer"></div>
  </div>

  <!-- Messages -->
  <div class="alert alert-success" *ngIf="successMessage">
    âœ… {{ successMessage }}
  </div>
  <div class="alert alert-error" *ngIf="errorMessage">
    âŒ {{ errorMessage }}
  </div>

  <!-- Statistiques -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon">ğŸ“‹</div>
      <div class="stat-value">{{ creneaux.length }}</div>
      <div class="stat-label">Total crÃ©neaux</div>
    </div>
    <div class="stat-card info">
      <div class="stat-icon">â˜€ï¸</div>
      <div class="stat-value">{{ countMatin }}</div>
      <div class="stat-label">Matin</div>
    </div>
    <div class="stat-card warning">
      <div class="stat-icon">ğŸŒ™</div>
      <div class="stat-value">{{ countApresMidi }}</div>
      <div class="stat-label">AprÃ¨s-midi</div>
    </div>
    <div class="stat-card success">
      <div class="stat-icon">ğŸ“…</div>
      <div class="stat-value">{{ filteredCreneaux.length }}</div>
      <div class="stat-label">AffichÃ©s</div>
    </div>
  </div>

  <!-- Actions principales -->
  <div class="actions-bar">
    <button class="btn btn-primary" (click)="openNewForm()">
      <span class="icon">â•</span> Nouveau CrÃ©neau
    </button>
    <label class="btn btn-info" [class.loading]="importing">
      <span class="icon">ğŸ“¤</span> Importer CSV
      <input type="file" accept=".csv" (change)="onFileSelected($event)" style="display: none;">
    </label>
    <button class="btn btn-danger" (click)="deleteAllCreneaux()" [disabled]="deleting || creneaux.length === 0">
      <span class="icon">ğŸ—‘ï¸</span> Supprimer Tout
    </button>
  </div>

  <!-- Import CSV - RÃ©sultats -->
  <div class="import-result" *ngIf="importResult">
    <h3>RÃ©sultat de l'import</h3>
    <p><strong>{{ importResult.success }}</strong> crÃ©neaux importÃ©s sur <strong>{{ importResult.total }}</strong> lignes traitÃ©es.</p>
    <div *ngIf="importResult.errors.length > 0" class="import-errors">
      <h4>âš ï¸ Erreurs :</h4>
      <ul>
        <li *ngFor="let error of importResult.errors">{{ error }}</li>
      </ul>
    </div>
  </div>

  <!-- Bouton pour importer -->
  <div class="import-section" *ngIf="selectedFile">
    <div class="file-selected">
      <span class="icon">ğŸ“„</span>
      <span>{{ selectedFile.name }}</span>
      <button class="btn btn-success btn-sm" (click)="importCsv()" [disabled]="importing">
        {{ importing ? 'Import en cours...' : 'Lancer l\'import' }}
      </button>
    </div>
  </div>

  <!-- Filtres et recherche -->
  <div class="filters-bar">
    <div class="filter-buttons">
      <button 
        class="filter-btn" 
        [class.active]="filterDemiJournee === ''"
        (click)="filterDemiJournee = ''; applyFilters()">
        Tous ({{ creneaux.length }})
      </button>
      <button 
        *ngFor="let option of demiJourneeOptions"
        class="filter-btn" 
        [class.active]="filterDemiJournee === option.value"
        (click)="filterDemiJournee = option.value; applyFilters()">
        {{ option.label }} ({{ countByDemiJournee(option.value) }})
      </button>
    </div>
    <div class="search-box">
      <input 
        type="text" 
        placeholder="ğŸ” Rechercher..." 
        [(ngModel)]="searchText"
        (input)="applyFilters()">
    </div>
  </div>

  <!-- Formulaire (Modal) -->
  <div class="modal-overlay" *ngIf="showForm" (click)="closeForm()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ isEditing ? 'Modifier' : 'Nouveau' }} CrÃ©neau</h2>
        <button class="btn-close" (click)="closeForm()">âœ•</button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="saveCreneau()">
          <div class="form-group">
            <label>LibellÃ© *</label>
            <input 
              type="text" 
              class="form-control"
              [(ngModel)]="currentCreneau.libelle"
              name="libelle"
              placeholder="Ex: CrÃ©neau 1 - J1 Matin"
              required>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Heure de dÃ©but *</label>
              <input 
                type="time" 
                class="form-control"
                [(ngModel)]="currentCreneau.heureDebut"
                name="heureDebut"
                required>
            </div>
            <div class="form-group">
              <label>Heure de fin *</label>
              <input 
                type="time" 
                class="form-control"
                [(ngModel)]="currentCreneau.heureFin"
                name="heureFin"
                required>
            </div>
          </div>

          <div class="form-group">
            <label>Demi-journÃ©e *</label>
            <select 
              class="form-control"
              [(ngModel)]="currentCreneau.demiJournee"
              name="demiJournee"
              required>
              <option *ngFor="let option of demiJourneeOptions" [value]="option.value">
                {{ option.label }}
              </option>
            </select>
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-secondary" (click)="closeForm()">
              Annuler
            </button>
            <button type="submit" class="btn btn-primary">
              {{ isEditing ? 'Modifier' : 'CrÃ©er' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Liste des crÃ©neaux groupÃ©s par demi-journÃ©e -->
  <div class="creneaux-list" *ngIf="!loading; else loadingTemplate">
    <div *ngIf="filteredCreneaux.length === 0" class="empty-state">
      <div class="empty-icon">ğŸ“­</div>
      <h3>Aucun crÃ©neau trouvÃ©</h3>
      <p>CrÃ©ez votre premier crÃ©neau ou importez-en depuis un fichier CSV.</p>
      <button class="btn btn-primary" (click)="openNewForm()">
        â• CrÃ©er un crÃ©neau
      </button>
    </div>

    <div *ngFor="let entry of getCreneauxByDemiJournee() | keyvalue" class="demi-journee-group">
      <h2 class="demi-journee-title">
        {{ getDemiJourneeLabel(entry.key) }}
        <span class="badge">{{ entry.value.length }}</span>
      </h2>
      
      <div class="creneaux-cards">
        <div *ngFor="let creneau of entry.value" class="creneau-card">
          <div class="creneau-header">
            <h3>{{ creneau.libelle }}</h3>
            <div class="creneau-actions">
              <button class="btn-icon btn-edit" (click)="editCreneau(creneau)" title="Modifier">
                âœï¸
              </button>
              <button class="btn-icon btn-delete" (click)="deleteCreneau(creneau.id!)" title="Supprimer">
                ğŸ—‘ï¸
              </button>
            </div>
          </div>
          <div class="creneau-body">
            <div class="creneau-time">
              <span class="icon">ğŸ•</span>
              <strong>{{ creneau.heureDebut }}</strong> - <strong>{{ creneau.heureFin }}</strong>
            </div>
            <div class="creneau-badge">
              {{ getDemiJourneeLabel(creneau.demiJournee) }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <ng-template #loadingTemplate>
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Chargement des crÃ©neaux...</p>
    </div>
  </ng-template>
</div>
